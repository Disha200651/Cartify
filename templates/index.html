<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Electronic Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* Simple professional palette for homepage */
        :root {
            --bg: #f6f7f9;
            --surface: #ffffff;
            --text: #1f2937;
            --muted: #6b7280;
            --primary: #c1121f; /* Brand red */
            --border: #e5e7eb;
            --shadow: 0 2px 12px rgba(0,0,0,0.06);
        }
        body { background: var(--bg); font-family: 'Roboto', sans-serif; color: var(--text); }
        
        /* Enhanced Navbar Styles */
        .navbar { background: var(--primary); box-shadow: 0 1px 0 var(--border); padding: 0.75rem 0; }
        
        .navbar-brand { font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1.5rem; color: #fff; }
        
        .navbar-brand:hover { color: #fff; opacity: 0.9; }
        
        .navbar-nav .nav-link { font-weight: 500; color: #ffeaea !important; padding: 0.75rem 1rem !important; border-radius: 0.5rem; margin: 0 0.25rem; transition: opacity 0.2s ease; position: relative; }
        
        .navbar-nav .nav-link:hover { color: #ffffff !important; background: transparent; }
        
        .navbar-nav .nav-link::after { display: none; }
        
        .navbar-nav .nav-link.active { color: #ffffff !important; background: transparent; }
        
        .navbar-nav .nav-link.active::after {
            width: 80%;
        }
        
        .navbar-toggler {
            border: none;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .navbar-toggler:focus { box-shadow: 0 0 0 0.2rem rgba(255,255,255,0.3); }
        
        .navbar-toggler-icon { filter: invert(1); }
        
        .cart-link {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .cart-badge { position: absolute; top: -8px; right: -8px; background: #dc3545; color: #fff; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600; }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .admin-btn { background: var(--primary); border: none; color: #fff !important; padding: 0.5rem 1rem !important; border-radius: 0.5rem; font-weight: 500; }
        
        .admin-btn:hover { filter: brightness(0.95); color: #fff !important; }
        
        .dropdown-menu {
            border: none;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem;
            padding: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .dropdown-item {
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }
        
        .dropdown-item:hover { background: #f3f4f6; color: var(--text); }
        
        .user-dropdown {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .user-avatar { width: 32px; height: 32px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 600; font-size: 0.875rem; }
        .hero { background: var(--surface); color: var(--text); border-radius: 0.75rem; padding: 2rem; margin-bottom: 2rem; box-shadow: var(--shadow); text-align: center; border: 1px solid var(--border); }
        /* Pop effect for buttons and search on homepage */
        .btn { transition: transform .12s ease, box-shadow .12s ease, filter .12s ease; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,0.08); filter: brightness(0.98); }
        .btn:active { transform: translateY(0); box-shadow: 0 2px 8px rgba(0,0,0,0.06); filter: none; }
        .input-group, .form-control { transition: transform .12s ease, box-shadow .12s ease; }
        #searchInput:hover { box-shadow: 0 0 0 0.15rem rgba(0,0,0,0.05); }
        #searchInput:focus { box-shadow: 0 0 0 0.25rem rgba(193,18,31,0.25), 0 6px 18px rgba(0,0,0,0.08); transform: translateY(-1px); }
        .input-group:focus-within { box-shadow: 0 6px 18px rgba(0,0,0,0.08); transform: translateY(-1px); border-radius: .375rem; }
        .hero h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
        }
        .hero p {
            font-size: 1.25rem;
            margin-top: 0.5rem;
            opacity: 0.95;
        }
        .product-card { transition: transform 0.18s, box-shadow 0.18s; box-shadow: var(--shadow); border: 1px solid var(--border); border-radius: 0.75rem; }
        .product-card:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
        .product-card img { height: 180px; object-fit: cover; border-radius: 1rem 1rem 0 0; }
        .product-card .btn-success { background: var(--primary); border: none; }
        .product-card .btn-success:hover { filter: brightness(0.95); }
        .bill { margin-top: 30px; }
        .bill .card { border-radius: 0.75rem; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .bill .card-header { background: var(--surface); color: var(--text); font-weight: 600; border-bottom: 1px solid var(--border); border-radius: 0.75rem 0.75rem 0 0; }
        .bill .btn-secondary { background: var(--primary); border: none; }
        .bill .btn-secondary:hover { filter: brightness(0.95); }
        .table th, .table td { vertical-align: middle; }
        @media (max-width: 767px) { .hero { padding: 1.5rem 1rem; } .product-card img { height: 140px; } }
    </style>
</head>
<body>
<header class="sticky-top">
  <nav class="navbar">
    <div class="container d-flex align-items-center topbar-container">
      <a class="navbar-brand me-2" href="#"><img src="{{ url_for('static', filename='logo.svg') }}" alt="Cartify" style="height:28px;width:auto;vertical-align:middle;margin-right:.5rem;" onerror="this.style.display='none'">Cartify</a>
      
      <ul class="navbar-nav ms-auto align-items-center flex-row top-actions">
        <li class="nav-item"><a class="nav-link" href="/orders">Orders</a></li>
        <li class="nav-item"><a class="nav-link" href="/cart"><i class="bi bi-cart3"></i> Cart</a></li>
        {% if current_user.is_authenticated %}
          {% if current_user.is_admin %}
          <li class="nav-item"><a class="nav-link" href="/admin"><i class="bi bi-gear"></i> Admin</a></li>
          {% endif %}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">{{ current_user.username }}</a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="/logout">Logout</a></li>
            </ul>
          </li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="/register">Register</a></li>
        {% endif %}
      </ul>
    </div>
  </nav>
  <div class="subbar" style="background:#a10f1a;">
    <div class="container d-flex align-items-center" style="min-height:44px;">
      <ul class="navbar-nav flex-row me-auto">
        <li class="nav-item">
          <a class="nav-link active" href="#" onclick="filterByCategory('all')">
            <i class="bi bi-grid-3x3-gap me-1"></i>All Products
          </a>
        </li>
        {% for category in categories %}
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="filterByCategory('{{ category.id }}')">
            <i class="bi bi-tag me-1"></i>{{ category.name }}
          </a>
        </li>
        {% endfor %}
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="/about" style="color:#ffeaea;">About</a></li>
      </ul>
    </div>
  </div>
</header>
<div class="container py-3">
    <div class="hero mb-5">
        <h1>Welcome to the Cartify</h1>
        <p class="mb-0">Discover the best deals on top electronics. Shop, buy, and get your bill instantly!</p>
    </div>
    
    <!-- Search and Filter Section -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="input-group">
                <input type="text" class="form-control" id="searchInput" placeholder="Search products...">
                <button class="btn btn-primary" type="button" onclick="searchProducts()">
                    <i class="bi bi-search"></i> Search
                </button>
            </div>
        </div>
        <div class="col-md-4">
            <select class="form-select" id="categoryFilter" onchange="filterByCategory(this.value)">
                <option value="all">All Categories</option>
                {% for category in categories %}
                <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    
    <div class="row g-4" id="productsGrid"></div>
</div>
<footer class="bg-dark text-light mt-5">
  <div class="container py-4">
    <div class="row">
      <div class="col-md-6">
        <span class="fw-bold">Cartify</span> â€¢ Quality electronics at great prices.
      </div>
      <div class="col-md-6 text-md-end mt-3 mt-md-0">
        <a href="/about" class="text-decoration-none text-light">About Us</a>
      </div>
    </div>
  </div>
  </footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
let products = [];
let currentCategory = 'all';
let currentSearch = '';

async function loadProducts() {
    let url = '/api/products';
    const params = new URLSearchParams();
    
    if (currentCategory !== 'all') {
        params.append('category_id', currentCategory);
    }
    if (currentSearch) {
        params.append('search', currentSearch);
    }
    
    if (params.toString()) {
        url += '?' + params.toString();
    }
    
    const res = await fetch(url);
    products = await res.json();
    displayProducts();
}

function displayProducts() {
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = '';
    
    if (products.length === 0) {
        grid.innerHTML = `
            <div class="col-12 text-center">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> No products found matching your criteria.
                </div>
            </div>
        `;
        return;
    }
    
    products.forEach(p => {
        grid.innerHTML += `
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card product-card h-100 animate__animated animate__fadeInUp">
                <img src="${p.image_url || 'https://via.placeholder.com/300x180?text=No+Image'}" class="card-img-top" alt="${p.name}">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">${p.name}</h5>
                    <p class="card-text small text-muted">${p.description || 'No description available'}</p>
                    <p class="card-text mb-1">Price: <b>â‚¹${p.price}</b></p>
                    <p class="card-text mb-2">Stock: ${p.stock}</p>
                    ${p.category ? `<p class="card-text small text-primary mb-2"><i class="bi bi-tag"></i> ${p.category}</p>` : ''}
                    <div class="mt-auto">
                        <div class="input-group mb-2">
                            <input type="number" min="0" max="${p.stock}" value="0" name="qty_${p.id}" class="form-control" placeholder="Quantity">
                            <button type="button" class="btn btn-success" onclick="addToCart(${p.id})">
                                <i class="bi bi-cart-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        `;
    });
}

function filterByCategory(categoryId) {
    currentCategory = categoryId;
    loadProducts();
}

function searchProducts() {
    currentSearch = document.getElementById('searchInput').value;
    loadProducts();
}

async function addToCart(productId) {
    const input = document.querySelector(`[name=qty_${productId}]`);
    const quantity = parseInt(input.value) || 0;
    
    if (quantity <= 0) {
        alert('Please enter a valid quantity');
        return;
    }
    
    try {
        const response = await fetch('/api/cart/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ product_id: productId, quantity: quantity })
        });
        
        const result = await response.json();
        
        if (response.ok) {
            input.value = 0;
            updateCartBadge(result.cart_count);
            showToast('Product added to cart!', 'success');
        } else {
            showToast(result.error, 'error');
        }
    } catch (error) {
        showToast('Error adding to cart', 'error');
    }
}

function updateCartBadge(count) {
    const badge = document.getElementById('cartBadge');
    if (count > 0) {
        badge.textContent = count;
        badge.style.display = 'block';
    } else {
        badge.style.display = 'none';
    }
}

function showToast(message, type) {
    const toastContainer = document.getElementById('toastContainer');
    if (!toastContainer) {
        const container = document.createElement('div');
        container.id = 'toastContainer';
        container.className = 'toast-container position-fixed top-0 end-0 p-3';
        container.style.zIndex = '1055';
        document.body.appendChild(container);
    }
    
    const toastHtml = `
        <div class="toast align-items-center text-white bg-${type === 'success' ? 'success' : 'danger'} border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    document.getElementById('toastContainer').innerHTML = toastHtml;
    const toastElement = document.querySelector('.toast');
    const toast = new bootstrap.Toast(toastElement);
    toast.show();
}

loadProducts();
</script>
</body>
</html> 